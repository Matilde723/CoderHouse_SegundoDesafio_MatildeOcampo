@page "/productos"

<h3>Productos</h3>

<!-- Tabla para deplegar productos -->
<table class="table">
    <thead>
        <tr>
            <th>Id</th>
            <th>Descripción</th>
            <th>Costo</th>
            <th>Precio Venta</th>
            <th>Stock</th>
            <th>Id Usuario</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var producto in productos)
        {
            <tr>
                <td>@producto.Id</td>
                <td>@producto.Descripcion</td>
                <td>@producto.Costo</td>
                <td>@producto.PrecioVenta</td>
                <td>@producto.Stock</td>
                <td>@producto.IdUsuario</td>
                <td>
                    <!-- Botones para update y Delete -->
                    <button class="btn btn-primary" @onclick="() => NavigateToEdit(producto.Id)">Modificar</button>
                    <button class="btn btn-danger" @onclick="() => DeleteProduct(producto.Id)">Eliminar</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Boton para crear producto nuevo -->
<button class="btn btn-success" @onclick="NavigateToCreate">Crear Nuevo Producto</button>

@code
{
    private List<Producto> productos = new List<Producto>();

    protected override void OnInitialized()
    {
        string connectionString = "Data Source=COMPUMATI\\MSSQLSERVER01;Initial Catalog=CoderhouseProyectoFinal;Integrated Security=True;Encrypt=True;TrustServerCertificate=True";

        productos = ProductoDataAccess.ListarProductos(connectionString);
    }

    private void NavigateToCreate()
    {
        
        NavigationManager.NavigateTo("/productos/crear");
    }

    private void NavigateToEdit(int id)
    {
        
        NavigationManager.NavigateTo($"/productos/editar/{id}");
    }

    protected void DeleteProduct(int productId)
    {
        string connectionString = "Data Source=COMPUMATI\\MSSQLSERVER01;Initial Catalog=CoderhouseProyectoFinal;Integrated Security=True;Encrypt=True;TrustServerCertificate=True";

        ProductoDataAccess.EliminarProducto(productId, connectionString);

        // Refreshear la lista de productos, después de eliminar
        productos = ProductoDataAccess.ListarProductos(connectionString);
    }

    [Inject] private NavigationManager NavigationManager { get; set; }
}
